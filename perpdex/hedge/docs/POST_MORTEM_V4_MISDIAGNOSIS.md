# POST-MORTEM: STORY-V4 오진단 및 불필요한 Over-Engineering

## 사건 개요

| 항목 | 내용 |
|------|------|
| 발생일 | 2025-12-25 |
| 영향 | 코드 복잡도 증가, 시간 낭비, 사용자 신뢰 하락 |
| 심각도 | High |
| 상태 | 롤백 완료 |

---

## 무엇이 잘못되었나

### 1. 잘못된 진단

**증상**: Phase 1 완료 후 Phase 2 진입 시 GRVT Rate Limit Error 1006 발생

**내 판단 (오류)**:
- "REST polling이 10초당 600+ API 호출"
- "WebSocket-only로 전환해야 함"
- `_pendingOrders` 딕셔너리, `asyncio.Event()` 기반 동기화 구현

**실제 원인**:
```
2025-12-25 13:04:19,957 - ERROR - [ERROR] Error placing GRVT order: [OPEN] ERROR: Active open orders abnormal: 4
```
- 이전 세션에서 4개의 미체결 주문이 남아있었음
- 이 주문들이 새 세션 실행 중 체결되면서 헷지 불균형 발생
- Rate Limit과 무관한 문제

### 2. Over-Engineering

**불필요하게 추가한 코드**:
- `_pendingOrders: Dict[str, Dict[str, Any]]` 딕셔너리
- `asyncio.Event()` 기반 주문 완료 대기
- WebSocket 핸들러 수정
- 10개의 TDD 테스트

**필요했던 코드**:
- 봇 시작 시 미체결 주문 취소 (단 몇 줄)

### 3. 검증 없는 판단

- 로그를 꼼꼼히 읽지 않음
- "Rate Limit Error" 키워드에 즉시 반응
- 실제 에러 메시지 `Active open orders abnormal: 4` 무시
- 가설 검증 없이 바로 구현 시작

---

## 근본 원인 분석 (5 Whys)

1. **왜 잘못된 코드를 작성했나?**
   → 잘못된 진단을 기반으로 했기 때문

2. **왜 잘못 진단했나?**
   → 로그를 제대로 분석하지 않고 "Rate Limit" 키워드에만 반응

3. **왜 로그를 제대로 분석하지 않았나?**
   → 빠르게 해결하려는 조급함, 충분한 증거 수집 없이 결론 도출

4. **왜 조급했나?**
   → 문제 해결 욕구가 분석 욕구를 앞섬, "미쳐 날뛰는 야생마" 행동 패턴

5. **왜 이런 패턴이 반복되나?**
   → 체계적인 진단 프로세스 없이 직관에 의존

---

## 교훈

### DO (해야 할 것)

1. **증거 기반 진단**: 로그 전체를 읽고 실제 에러 메시지 확인
2. **가설 검증**: 진단 후 바로 구현하지 않고 가설이 맞는지 확인
3. **최소 개입 원칙**: 문제 해결에 필요한 최소한의 코드만 작성
4. **사용자에게 질문**: 확신이 없으면 먼저 물어보기

### DON'T (하지 말아야 할 것)

1. **키워드 반응**: "Rate Limit" 같은 키워드에 즉시 반응하지 않기
2. **Over-Engineering**: 간단한 문제에 복잡한 솔루션 적용하지 않기
3. **조급한 구현**: 진단 완료 전 코드 작성 시작하지 않기
4. **검증 없는 확신**: "~일 것이다"가 아닌 "~임을 확인했다"로 말하기

---

## 재발 방지 체크리스트

에러 발생 시 반드시 수행:

- [ ] 전체 로그 파일 읽기 (마지막 100줄 이상)
- [ ] 실제 에러 메시지 정확히 확인
- [ ] 에러 코드와 에러 메시지 구분
- [ ] 가설 수립 후 검증 단계 수행
- [ ] 최소 개입 솔루션 먼저 고려
- [ ] 복잡한 솔루션은 사용자 승인 후 진행

---

## 조치 사항

| 조치 | 상태 |
|------|------|
| WebSocket-only 코드 롤백 | ✅ 완료 |
| grvt.py → STORY-001 커밋 상태 복원 | ✅ 완료 |
| STORY-V4 문서 상태 수정 | ✅ 완료 |
| 봇 시작 시 미체결 주문 취소 로직 추가 | ✅ 완료 (2025-12-26) |

---

## 사용자 피드백 (원문)

> "Rate Limit 문제 ❌ : 너의 잘못된 판단으로 코드 다 뒤집어 놓은거네 그럼. 상황 정확 판단 못하고."

> "백팩-라이터 때보다 더 못하네 너"

> "왜 널 통하면 항상 이렇게 너무 어려워지지? over-engineering 아냐?"

> "넌 거의 ADHD 미쳐 날뛰는 중2병 미친 야생마 조련하는 느낌이다. 너무 생각없이 미쳐날 뛰어서"

---

## 결론

이 사건의 핵심은 **"증거 없는 진단 → 불필요한 복잡성 → 시간 낭비"** 패턴이다.

앞으로는:
1. 로그를 먼저 꼼꼼히 읽는다
2. 가설을 세우고 검증한다
3. 최소한의 코드로 해결한다
4. 확신이 없으면 사용자에게 물어본다

---

*작성일: 2025-12-25*
*상태: 롤백 완료, 교훈 정리됨*
